<!DOCTYPE html>
<html>
<head>
    <title>WorldChef FCM Token Generator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        button { background: #4285f4; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        button:hover { background: #3367d6; }
        textarea { width: 100%; margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üî• WorldChef FCM Token Generator</h1>
    <p>This page will generate an FCM token for testing push notifications.</p>
    
    <button id="requestPermission">1. Request Notification Permission</button>
    <div id="permissionStatus"></div>
    
    <br><br>
    
    <button id="getToken" disabled>2. Get FCM Token</button>
    <div id="tokenResult"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getMessaging, getToken, onMessage } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging.js';

        // Firebase config for worldchef-3fd9e
        const firebaseConfig = {
                apiKey: "AIzaSyBF1j1YSqaRBRO28D74cZe3K54Q4297lL4",
                authDomain: "worldchef-3fd9e.firebaseapp.com",
                projectId: "worldchef-3fd9e",
                storageBucket: "worldchef-3fd9e.firebasestorage.app",
                messagingSenderId: "269410347283",
                appId: "1:269410347283:web:731092e13f20d918ad92e6",
                measurementId: "G-Y7SENR2TZX"
        };

        // VAPID key from user
        const vapidKey = "BA341pSOPamDldbNdqSKzqcrnt3ETrkgy1HOe9CQvAdDMNa5slbKRRFrSuMsrY4dzhAVfi66yfBg9WhvfrY7Bz4";

        let app, messaging;

        try {
            app = initializeApp(firebaseConfig);
            messaging = getMessaging(app);
        } catch (error) {
            document.getElementById('permissionStatus').innerHTML = `<div class="error">Firebase initialization failed. You need to get the API key, sender ID, and app ID from Firebase Console.</div>`;
        }

        // Request notification permission
        document.getElementById('requestPermission').addEventListener('click', async () => {
            try {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    document.getElementById('permissionStatus').innerHTML = '<div class="success">‚úÖ Notification permission granted!</div>';
                    document.getElementById('getToken').disabled = false;
                } else {
                    document.getElementById('permissionStatus').innerHTML = '<div class="error">‚ùå Notification permission denied. Please allow notifications and try again.</div>';
                }
            } catch (error) {
                document.getElementById('permissionStatus').innerHTML = `<div class="error">Error requesting permission: ${error.message}</div>`;
            }
        });

        // Get FCM token
        document.getElementById('getToken').addEventListener('click', async () => {
            if (!messaging) {
                document.getElementById('tokenResult').innerHTML = '<div class="error">Firebase not initialized. Check console for errors.</div>';
                return;
            }

            try {
                const token = await getToken(messaging, { vapidKey: vapidKey });
                
                document.getElementById('tokenResult').innerHTML = `
                    <div class="success">
                        <h3>‚úÖ FCM Token Generated Successfully!</h3>
                        <p><strong>Copy this token to your .env.local file:</strong></p>
                        <textarea rows="4" cols="80" readonly onclick="this.select()">${token}</textarea>
                        <p><strong>Add this line to your .env.local:</strong></p>
                        <code>FCM_TEST_TOKEN=${token}</code>
                    </div>
                `;
                
                console.log('FCM Token:', token);
            } catch (error) {
                document.getElementById('tokenResult').innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error getting token:</h3>
                        <p>${error.message}</p>
                        <p><strong>Common issues:</strong></p>
                        <ul>
                            <li>Missing Firebase config values (API key, sender ID, app ID)</li>
                            <li>Notifications not enabled in browser</li>
                            <li>Invalid VAPID key</li>
                        </ul>
                    </div>
                `;
                console.error('Error getting token:', error);
            }
        });

        // Listen for messages (optional)
        if (messaging) {
            onMessage(messaging, (payload) => {
                console.log('Message received:', payload);
                alert(`Push notification received: ${payload.notification?.title}`);
            });
        }
    </script>

    <hr>
    <h3>üìã Instructions:</h3>
    <ol>
        <li><strong>Get Firebase Config:</strong> Go to Firebase Console ‚Üí Project Settings ‚Üí General ‚Üí Your apps ‚Üí Web app ‚Üí Config</li>
        <li><strong>Update this file:</strong> Replace the placeholder values in firebaseConfig with your actual values</li>
        <li><strong>Open this file:</strong> Open this HTML file in your browser</li>
        <li><strong>Generate token:</strong> Click the buttons above to get your FCM token</li>
        <li><strong>Add to .env.local:</strong> Copy the token to your .env.local file</li>
    </ol>

    <h3>üîß Missing Firebase Config Values:</h3>
    <p>You need to get these from <a href="https://console.firebase.google.com/project/worldchef-3fd9e/settings/general" target="_blank">Firebase Console ‚Üí Project Settings ‚Üí General</a>:</p>
    <ul>
        <li><code>apiKey</code></li>
        <li><code>messagingSenderId</code></li>
        <li><code>appId</code></li>
    </ul>
</body>
</html> 